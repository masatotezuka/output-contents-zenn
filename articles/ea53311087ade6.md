---
title: "Web APIの基本"
emoji: "🐡"
type: "tech"
topics: []
published: false
---


## Web APIとは
そもそもWeb APIとは、
「HTTPプロトコルを利用してネットワーク越しに呼び出すAPI」
機能は知っているけれど、その中身の実際の動作は詳しくわからない機能のカタマリを、外部から呼び出す仕様のことを指す。
Web APIはHTTPを使用して呼び出すので、エンドポイントはURIで指定される。

Twitterでの例
下記のURLにアクセスすると、タイムラインデータが取得できる。（認証情報をセットする必要あり）
```
htttps://api.twitter.com/1.1/statues/user_timeline.json
```

## Web APIの重要性
web APIを公開することで、第3者がそのAPIの付加価値を与えてくれることがある。例えば、Twitterは2006年からAPIを公開していたとで、開発者がTwitterに投稿されたデータを使って分析を行うサービスや、botと呼ばれる機械的に生成したメッセージを投稿するシステムなどが開発された、それにより、Twitterは情報がたくさん集まり、巨大なエコシステムができあがった。また、既に公開されているAPIを利用することで、自社サービスの開発コストを削減することができる。運用コストと開発コストを比較する必要はあるが、人件費・開発時間を考えたときにAPIを利用したほうが割安になることが多いそうだ。


## Web APIを美しく設計する重要性

APIを美しくく設計する理由は４つある。
- 設計の美しいWeb APIは使いやすい
- 設計の美しいWeb APIは変更しやすい
- 設計の美しいWeb APIは頑強である
- 設計の美しいWeb APIは恥ずかしくない

「設計の美しいWeb APIは使いやすい」
APIは自分以外の者に利用されることが多い。第3者がAPIを利用するときに、APIの使いやすさによって開発工数や開発者の受けるストレスに大きく影響が出てくる。

「設計の美しいWeb APIは変更しやすい」
Webサービスやシステムは変化していくことが多く、それに伴いインターフェースのAPIも変化していく。APIの仕様が変わったことにより、APIを利用したサービスやシステムが運用が止まることが避けなければいけない。従って、APIを変更しても利用者に影響がなく行うかが重要。

「設計の美しいWeb APIは頑強である」
Web APIはインターネットを通じてサービスを提供するものである場合が多く、誰でもアクセスが可能になってしまうため、セキュリティの問題に必ず対処しなければいけない。

「設計の美しいWeb APIは恥ずかしくない」
　Web APIは通常のウェブサイト、ウェブサービスとは異なり、開発者が目にすることが多い。APIの設計が悪いことで優秀な開発者を集めることができないかもしれない。
 
 
 ## APIの設計
 ### エンドポイントの設計とリクエストの形式
API設計するために必要な機能を洗い出し、機能ごとにエンドポイントを決めていく必要がある。エンドポイントとは、APIにアクセスするためのURLのことを指す。機能の洗い出しは画面遷移を書きながらやるとよい。
SNSサービスを例に出すと、「ユーザー登録」「ログイン」「自分の情報の取得」「友達の検索」などがあるでしょう。一通り機能を洗い出したら、エンドポイントを設計していく。良いエンドポイント、つまり良いURIの設計とは **「覚えやすく、どんな機能を持つURIなのかがひと目でわかる」**　である。

#### 短く入力しやすいURI
```
htttps://api.exmple.com/service/api/search
```
このURLは、「api」「search」という言葉が入っていることから、何らかの検索用のAPIでであることがわかる。「api」という言葉が２つ入っていたり、「api」と似た概念の言葉である「service」という言葉が含まれている。短く入力しやすいURIにすると下記のようになり、何らかの検索用のAPIであることは理解できる。
```
htttps://api.exmple.com/search
```

#### 人間が読んで理解できるURI
```
https://api.exmple.com/sv/u
```
このURLはapiという言葉が入っているのでAPIであることはわかるが、「sv」「u」も意味がわからない。短いURIにしようとしても、意味がわかるURI設計にしないと利用者側に負担がかかる。理解しやすいURIにするためのポイントは3つある。1つ目は省略形を使わないことである。英語を母語としている人たちは、productsをprob、weekをwkなど省略することが普通かもしれないが、APIを使う開発者は必ずしも英語が母国語ではないかもしれない。2つ目は、APIでよく使われている英単語を使用することである。言語は、世界的な共通言語である英語を使用することは最も適切である。API使われる言語を知るには、実際に他のAPIをみてみるのが一番である。ProgrammabelWebのAPIディレクトリには多くのAPIが登録されている。ドキュメントをみた際には、複数のAPIを比べてよく使われている、最もしっくりくる単語を選ぶと良い。3つ目は、スペルミスをしないこと。スペルミスにより、実際のAPIでのスペルミスなのか、それともドキュメントのスペルミスなのかが見た目ではわからず、開発者は困惑することになる。複数形や過去形は間違いやすいので注意が必要である。（例えば、「checked out」を「check outed」としてしまうなど。）

**大文字小文字が混在しないURI**
URLのアルファベットは基本的にすべて小文字にしたほうがよい。大文字小文字の混在はAPIをわかりづらくし、間違えやすくする。下記のgetUserNameのような場合は、get-user-nameにすればいいのではなく、そもそも命名に問題がある。
```
https://api.exmple.com/API/getUserName
```

大文字を混ぜたURIにアクセスした場合は、NotFoundの404エラーを返すことが多いようだ。

#### 改造しやすいURI
改造しやすいURIを英語で言うと、"Hackable"、つまりハックしやすいURIということであり、URIを修正して別のURIにするのが容易であることを意味する。
例えば、IDが1〜50000までのURIは「https://api.exmple.com/items/alpha/:id」 で、IDが50000〜のURIは「https://api.exmple.com/items/beta/:id」 のような場合、利用者はドキュメントを確認する必要があり、このURI設計は改造しやすいURIではないということがわかる。

#### サーバー側のアーキテクチャが反映されていないURI
サーバー側のアーキテクチャとは、どんなサーバーソフトウェアを利用しているか、どんな言語を使って実装を行っているか、サーバーサイドのディレクトリ構造やシステム構成がどうなっているかということです。URIからサーバー側のアーキテクチャの特定を容易にしてしまうと、攻撃を受ける可能性がある。

#### ルールが統一されたURI

Web APIを提供する場合は、通常複数のエンドポイントを公開することが多く、エンドポイントのルールを統一しておく必要がある。例えば、SNSを例にすると、友達情報の取得とメッセージの取得がなどある。

友達情報の取得
```
https://api.exmple.com/friends?id=100
```

メッセージの送信
```
https://api.exmple.com/friend/100/messsage
```
一方はIDとクエリパラメーターで指定するようになっており、もう一方はURIのパスの中にIDが含まれるようになっている。このように統一感ないAPIは利用者を混乱させるため、ルールは統一させる必要がある。

友達情報の取得
```
https://api.exmple.com/friends/100
```

メッセージの送信
```
https://api.exmple.com/friend/100/messsage
```